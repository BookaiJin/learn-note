# 资源隔离

## CPU资源隔离

通过对执行任务的线程指定线程组，对线程组进行CPU使用占用统计来实现，任务组之间的CPU占用率的管控；

通过对各任务组内的线程使用的CPU占用率统计，中断/停止线程来保证任务组对CPU占用率维持在合理区间；

对CPU资源进行监控甚至管理，我们首先要理清楚CPU的使用率到底是什么

我们在Linux上看下CPU的使用情况：

[top 命令，Linux top 命令详解：显示或管理执行中的程序 - Linux 命令搜索引擎 (wangchujiang.com)](https://wangchujiang.com/linux-command/c/top.html)

可以在环境中使用man top查看详细内容[top(1) - Linux manual page (man7.org)](https://man7.org/linux/man-pages/man1/top.1.html)

通过top指令我们拿到：

![image-20210711221344580](/Users/bokai/pro/learn-note/资源隔离.assets/image-20210711221344580.png)

top-当前时间

up XX days, HH:mm, 本次开机运行的次数 对于客户未知的服务器重启导致FR服务器重启，可以通过这个配置来验证

当前系统登录的用户数

id 空闲的CPU

wa 等待io

hi硬件中断，网卡、磁盘、外设之类的有信号向CPU发送时候，就会产生硬件中断；编写的内核处理硬件中断的程序会阻塞CPU

系统负载：1、5、15分钟内处理的任务负载，也就是在这个窗口期，CPU处理了多少个任务；从网上整体查找到的资料来看，逻辑CPU的负载，(处理的任务数+排队的任务数)/时间段内可以处理的任务数，非压测模式下长期负载在0.7及以下较为合适，如果长时间居高位可能需要更换CPU

CPU使用率：由于一个进程的多线程处理模式，在非线程模式「top -H」下，CPU使用率是有可能超过100%的，这个涉及到了CPU个数、核心数、逻辑处理器「processor」

比如一颗十核心的CPU，通过SMT「超线程」技术可以有二十颗处理器，我们一条线程使用一个处理器，就会导致top界面的百分比超过100%

![image-20210712004448309](/Users/bokai/pro/learn-note/资源隔离.assets/image-20210712004448309.png)

### 分配CPU资源

通过对划定资源占用分布，适合任务组

比如：

###高占用任务停止

选取高CPU占用线程，外部发送中断/停止信号，适合单个任务

##内存资源隔离